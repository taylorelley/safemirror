# ====================================
# SafeMirror Helm Chart - Default Values
# ====================================

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# ====================================
# API Server
# ====================================
api:
  replicaCount: 2
  
  image:
    repository: safemirror/api
    tag: ""  # Defaults to appVersion
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8000
  
  resources:
    limits:
      cpu: "2"
      memory: 2Gi
    requests:
      cpu: "500m"
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  
  # Pod disruption budget
  pdb:
    enabled: true
    minAvailable: 1

# ====================================
# Frontend
# ====================================
frontend:
  replicaCount: 2
  
  image:
    repository: safemirror/frontend
    tag: ""
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 3000
  
  resources:
    limits:
      cpu: "1"
      memory: 1Gi
    requests:
      cpu: "250m"
      memory: 256Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# ====================================
# Celery Worker
# ====================================
worker:
  replicaCount: 2
  
  image:
    repository: safemirror/api
    tag: ""
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: "2"
      memory: 2Gi
    requests:
      cpu: "500m"
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
  
  concurrency: 4
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# ====================================
# Celery Beat (Scheduler)
# ====================================
beat:
  enabled: true
  
  image:
    repository: safemirror/api
    tag: ""
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: "500m"
      memory: 256Mi
    requests:
      cpu: "100m"
      memory: 128Mi
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# ====================================
# Ingress
# ====================================
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    # cert-manager annotations
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: safemirror.example.com
      paths:
        - path: /api
          pathType: Prefix
          service: api
        - path: /
          pathType: Prefix
          service: frontend
  tls: []
  # - secretName: safemirror-tls
  #   hosts:
  #     - safemirror.example.com

# ====================================
# PostgreSQL (Bitnami subchart)
# ====================================
postgresql:
  enabled: true
  auth:
    username: safemirror
    password: ""  # Set in secrets
    database: safemirror
    existingSecret: ""
  primary:
    persistence:
      enabled: true
      size: 20Gi
    resources:
      limits:
        cpu: "2"
        memory: 2Gi
      requests:
        cpu: "500m"
        memory: 512Mi

# External PostgreSQL (when postgresql.enabled=false)
externalDatabase:
  host: ""
  port: 5432
  database: safemirror
  username: safemirror
  password: ""
  existingSecret: ""
  existingSecretPasswordKey: "password"

# ====================================
# Redis (Bitnami subchart)
# ====================================
redis:
  enabled: true
  auth:
    enabled: false
    password: ""
  master:
    persistence:
      enabled: true
      size: 8Gi
    resources:
      limits:
        cpu: "1"
        memory: 512Mi
      requests:
        cpu: "250m"
        memory: 128Mi

# External Redis (when redis.enabled=false)
externalRedis:
  host: ""
  port: 6379
  password: ""
  existingSecret: ""
  existingSecretPasswordKey: "password"

# ====================================
# Configuration
# ====================================
config:
  # Application
  appName: "SafeMirror Enterprise"
  debug: false
  
  # JWT
  secretKey: ""  # REQUIRED: Set via secrets
  algorithm: "HS256"
  accessTokenExpireMinutes: 30
  refreshTokenExpireDays: 7
  
  # SMTP
  smtp:
    host: ""
    port: 587
    user: ""
    password: ""
    fromEmail: "noreply@safemirror.local"
    fromName: "SafeMirror"
    useTLS: true
  
  # Webhooks
  webhookTimeout: 30
  webhookMaxRetries: 3

# ====================================
# Secrets
# ====================================
secrets:
  # Create secrets from values (for testing only!)
  create: true
  
  # Use existing secrets
  existingSecret: ""
  
  # Keys in existing secret
  secretKeyKey: "secret-key"
  databasePasswordKey: "database-password"
  redisPasswordKey: "redis-password"
  smtpPasswordKey: "smtp-password"

# ====================================
# Service Account
# ====================================
serviceAccount:
  create: true
  annotations: {}
  name: ""

# ====================================
# Pod Security
# ====================================
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

# ====================================
# Monitoring
# ====================================
metrics:
  enabled: false
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    scrapeTimeout: 10s
